# 变更提案: SSH 一键向导（目标端免安装）

## 需求背景

现在的 AgentSync 虽然能同步，但第一次要跑通会卡在“SSH 怎么配、密钥怎么弄、目标端要建哪些目录”这些步骤上，尤其是从 Windows 迁移到 macOS 的场景：用户只想点几下就能传，不想研究一堆 SSH 细节。

本变更的目标是把“第一次配置”做成向导：**源电脑一键生成密钥 + 生成目标端初始化命令**，用户只需要在目标电脑开启 SSH 并粘贴执行一次命令，就能回到源电脑点“测试连接 / 开始同步”。

<!-- ⚠️ 仅在触发 G8 时生成此章节 -->
## 产品分析

### 目标用户与场景
- **用户群体:** 需要在两台电脑之间迁移/同步工作环境的人（Windows ↔ macOS / Linux / Windows）
- **使用场景:** 新电脑到手，想把“项目文件夹 + Codex 聊天记录 + .agents 技能配置”快速同步过去
- **核心痛点:** 不想手动折腾 SSH、目录、权限；希望像 LocalSend 一样“点一下就能传”

### 价值主张与成功指标
- **价值主张:** 目标端尽量免安装，第一次配置只做一次，之后一键同步
- **成功指标:**
  - 新手按向导操作，10 分钟内跑通一次同步
  - 目标端不需要安装 AgentSync（SSH 模式）

### 人文关怀
- 默认不让用户把密码存进工具里；只用密钥
- 镜像删除属于“看起来很吓人”的行为：必须提供可找回的备份目录，并在界面上明确告知
<!-- 产品分析章节结束 -->

## 变更内容
1. 新增“设备向导”页面：引导用户完成 SSH 模式的一次性配置
2. 支持“一键生成/读取公钥”：减少用户自己跑 ssh-keygen 的步骤
3. 生成目标端初始化命令（macOS/Linux 优先，Windows 给出可用但更谨慎的提示）

## 影响范围
- **模块:** 前端 UI、Tauri 后端 commands、本机配置
- **文件:** `src/`、`src-tauri/src/`、知识库文档
- **API:** 新增 Tauri commands（用于生成密钥、读取公钥）
- **数据:** 本机 `~/.agentsync/` 下新增 keys 目录（存放 AgentSync 专用密钥）

## 核心场景

### 需求: SSH 一键向导（A 模式）
**模块:** UI / 配置 / 同步引擎
用户希望目标端（例如 macOS）不装软件，只需要开启 SSH，然后按向导一步步完成配置。

#### 场景: Windows → macOS 首次跑通
目标端打开“远程登录(SSH)”后：
- 用户在源电脑（Windows）打开“设备向导”，一键生成密钥并复制“目标端初始化命令”
- 用户在目标电脑（macOS）终端粘贴运行一次命令（写入 authorized_keys + 创建目录）
- 回到源电脑，点“测试连接”通过后即可开始同步

## 风险评估
- **风险:** 镜像删除可能导致用户误删目标端文件
- **缓解:** rclone 强制 `--backup-dir`，把被覆盖/删除的内容移动到备份目录，并在 UI 里明确提示与二次确认

