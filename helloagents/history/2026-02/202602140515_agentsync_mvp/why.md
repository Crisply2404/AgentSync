# 变更提案: AgentSync MVP（单向同步）

## 需求背景

你现在的痛点很明确：换电脑（Windows ↔ macOS）时，要同步的东西很多，而且分散在不同位置：
- 项目代码（而且常常不止一个项目）
- Codex 的配置 + 聊天记录（sessions）
- 额外技能/工具配置（`.agents`）

手动复制的问题是：**容易漏、容易拷错、还容易把一堆“装出来/编出来”的垃圾一起拷过去**。

<!-- ⚠️ 新项目/新功能，触发 G8 产品设计原则 -->
## 产品分析

### 目标用户与场景
- **用户群体:** 经常在 Windows / macOS / Linux 多机开发的人（你就是典型）
- **使用场景:** 换机迁移、家里/公司两台电脑来回用、或需要备份到另一台电脑
- **核心痛点:** 手动同步太麻烦，容易出错；特别是 Codex 记录和隐藏目录经常忘拷

### 价值主张与成功指标
- **价值主张:** 你只要点一下按钮，就能把“你关心的东西”推到另一台电脑上
- **成功指标（MVP）:**
  - 第一次配置 ≤ 5 分钟
  - 一键同步成功率高（失败时能看懂原因）
  - 同步后能在目标电脑直接看到项目和 Codex 聊天记录

### 人文关怀
- 不在配置里保存私钥内容（只保存“私钥文件路径”）
- 默认启用“删除/覆盖备份”，避免误删后不可恢复
- 日志尽量用大白话提示，不吓人

## 变更内容

1. 做一个跨平台桌面 App（Tauri + React），能点选要同步的项目文件夹
2. 支持 SSH（SFTP）连接配置与“测试连接”
3. 一键同步：**默认镜像删除**（目标端变得跟源端一致）
4. 镜像删除/覆盖必须可恢复：把会被删除/覆盖的目标端文件放入备份目录
5. 可选同步 Codex（`.codex`）和 `.agents`
6. 展示同步进度、同步历史、日志查看

## 影响范围

- **模块:**
  - UI
  - Sync Engine
  - Config
- **文件:**
  - 新增前端与 Tauri 后端代码（MVP 预计会新增一批文件）
  - 新增 `helloagents/wiki/*` 模块文档补全
- **API:**
  - 仅桌面 App 内部命令（Tauri commands）
- **数据:**
  - 新增本机配置文件与运行历史文件

## 核心场景

### 需求: 配置连接信息
**模块:** UI / Config  
用户填好 Host/User/Key，然后点“测试连接”，确认能连上目标电脑，并且目标目录可写。

#### 场景: Key 文件路径错误
本机 key 文件不存在  
- 预期结果：提示“找不到 key 文件”，不给启动同步

### 需求: 选择要同步的项目
**模块:** UI / Config  
用户点“添加项目”，直接选中一个文件夹，项目出现在列表里，可开关启用。

#### 场景: 项目名冲突
两个项目文件夹名字一样  
- 预期结果：提示并要求改“远端目录名”

### 需求: 一键镜像同步（含删除）
**模块:** Sync Engine  
点击“一键同步”，目标端变得跟源端一致（镜像）。

#### 场景: 目标端有多余文件
目标端存在源端没有的文件  
- 预期结果：这些文件不会直接消失，而是被放进备份目录（可找回）

### 需求: 同步 Codex 聊天记录
**模块:** Sync Engine / Config  
勾选“同步 Codex”，把 `.codex/config.toml` 和 `.codex/sessions/` 推到目标端的 `~/.codex/`。

#### 场景: 目标端已有自己的 sessions
目标端比源端多一些 sessions  
- 预期结果：按镜像规则处理，但目标端被移走/覆盖的内容进入备份目录

## 风险评估

- **风险:** 镜像删除可能造成误删  
  **缓解:** 默认启用备份目录；日志清楚写出“备份放哪了”
- **风险:** SSH 连接失败/权限不足  
  **缓解:** 先提供“测试连接”；错误信息用大白话
- **风险:** 大项目同步慢  
  **缓解:** 默认排除 node_modules/dist 等；后续可加增量策略/并发控制

